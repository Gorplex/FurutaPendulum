<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>PolyDAQ: Connecting Sensors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PolyDAQ
   &#160;<span id="projectnumber">2.1</span>
   </div>
   <div id="projectbrief">Cal Poly ME Data Acquisition and Logging System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Connecting Sensors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes how to connect a PolyDAQ to various types of sensors.</p>
<h1><a class="anchor" id="sec_sg"></a>
Strain Gauges</h1>
<h2><a class="anchor" id="sg_steps"></a>
Steps</h2>
<ol type="1">
<li>Wire up a full, four-resistance Wheatstone bridge. If using a half-bridge or quarter-bridge circuit, connect dummy gauges or passive resistors at this time.</li>
<li>Before connecting the bridge to the PolyDAQ, check the resistances between all the corners of the bridge. These should be <code>R</code> between opposite corners and <code>3/4</code> <code>R</code> between adjacent corners.</li>
<li>Connect the bridge to the <code>VEX</code>, <code>Sn+</code>, <code>Sn-</code>, and <code>GND</code> terminals of one bridge amplifier.</li>
<li>Balance the strain gauge bridge so that it gives a known reading, usually half the maximum full-scale output, at zero strain.<ul>
<li><b>Auto-balanced</b> (strain channels 1 and 2):<ul>
<li>Using a dumb terminal, issue the <b>L</b> command for channel <code>S1</code> or the <b>M</b> command for channel <code>S2</code>. This runs the auto-balancer.</li>
<li>You should receive a message saying "<code>Strain</code> <code>bridge</code> <em>ch</em> <code>balanced</code> <code>to</code> <em>number"</em> where <em>ch</em> is channel 1 or 2 and <em>n</em> is the A/D output for zero strain, usually set to about 2048 (any number near 2000 is fine).</li>
<li>If you receive a message saying the bridge could <em>not</em> be balanced, disconnect the entire Wheatstone bridge from the PolyDAQ and re-check the resistances with an ohmmeter. Note that using old, inexpensive 5% tolerance resistors to complete a quarter-bridge or half-bridge may cause the bridge to be too far out of balance to use with the auto-balancer; using a manually balanced channel 3 or 4 may solve this problem (or better yet, get more precisely toleranced resistors).</li>
</ul>
</li>
<li><b>Manually</b> <b>balanced</b> (strain channels 3 and 4):<ul>
<li>Connect a voltmeter to measure the voltage between test point <b>S3</b> or <b>S4</b>, at the edge of the circuit board, and <b>GND</b>. Use a tiny screwdriver to slowly rotate the adjustment screw on top of the bridge balancing potentiometer (a blue rectangular box) labeled <code>BAL_3</code> or <code>BAL_4</code> on the board. Adjust the potentiometer until the voltage between <b>S3</b> or <b>S4</b> and <b>GND</b> is about 1.67 volts. These are 15-turn trim potentiometers, so it may take several turns of the screwdriver.</li>
</ul>
</li>
</ul>
</li>
<li>Calibrate the bridge as necessary for your application. This may be done by applying known loads and examining the resulting output, or by performing the appropriate calculations using the known gauge, amplifier, and A/D converter properties.</li>
</ol>
<div class="image">
<img src="strain_bridge_connections_small.png" alt="strain_bridge_connections_small.png"/>
</div>
 <h2><a class="anchor" id="sg_details"></a>
Details</h2>
<p>Strain gauges must be connected in a Wheatstone bridge circuit, and the bridge must be built entirely by the user. There are no brige completion resistors on the PolyDAQ board. Strain gauges and resistors of any resistance from 120 ohms to 1000 ohms may be used, as long as all the resistances are the same within a given bridge. 350 ohm gauges are preferred, as they give a good balance between low power usage (for which higher resistance gauges are better) and low noise (for which lower resistance gauges are better). If plain resistors are used to complete a quarter- or half-bridge, precision resistors of 1% or better tolerance are recommended.</p>
<p>Before connecting a strain gauge bridge to the PolyDAQ 2, connect all four resistances in the bridge (be they active gauges, dummy gauges, or resistors) and use an ohmmeter to check the resistances between the corners of the bridge. The resistance between opposite bridge corners should be equal to the resistance of each gauge or resistor. The resistance between adjacent corners (across each one resistance) should be 3/4 of the resistance of one resistor when that resistor was out of the bridge. If the bridge resistances are not within 1% of the values they should have, <code>do</code> <code>not</code> connect the bridge to the PolyDAQ; it will be impossible to balance and won't work. Fix the bridge and <em>then</em> connect it. <b>Note:</b> Do not attempt to measure bridge resistances after connecting the bridge to the PolyDAQ board; always disconnect the bridge from the board before measuring resistances.</p>
<p>The four "corners" of the bridge are connected to a set of four adjacent terminals <code>VEX</code>, <code>Sn+</code>, <code>Sn-</code>, and <code>GND</code> on the PolyDAQ. The <code>VEX</code> terminal is the excitation voltage, which is controlled by the board's onboard regulator at 3.3V. The <code>Sn+</code> and <code>Sn-</code> terminals (replace the letter <code>n</code> with the bridge number) connect to the Wheatstone bridge's outputs, which are sometimes referred to as the bridge's <code>A</code> and <code>B</code> outputs on documentation. The <code>GND</code> connection is of course ground.</p>
<h3><a class="anchor" id="sss_sg_bal"></a>
Balancing Strain Gauge Bridges</h3>
<p>Each PolyDAQ 2 has two strain gauge bridges which can be automatically balanced. There are two auto-balanced bridges because the STM32F405VG microcontroller has two D/A converters which are used for the balancing. On boards with four bridge amplifiers, two of the bridges use manual balancing potentiometers which are discussed below.</p>
<p>The <b>auto-balancer</b> can be operated from the PolyDAQ GUI or a terminal. The GUI is documented in its own section of this manual. When communicating with a PolyDAQ 2 through a dumb terminal, the strain bridge auto-balancer is invoked by the commands <b>L</b> and <b>M</b> for the first and second bridges respectively. A message will be shown in the terminal telling if the auto-balancing was successful. If there is a problem with the bridge resistances (usually, one resistance is missing or a connection is bad) the bridge cannot be balanced. The bridge must be disconnected from the PolyDAQ and re-checked with an ohmmeter. When the problem has been solved, reconnect the bridge and auto-balancing should be successful.</p>
<p>The <b>manual</b> <b>balancer</b> is operated by turning the adjustment screws on each of the two bridge balancing potentiometers marked <code>BAL_3</code> and <code>BAL_4</code>. The potentiometers are blue colored rectangular boxes near the <code>S3</code> and <code>S4</code> inputs on the terminal blocks. Use a voltmeter (<b>not</b> an oscilloscope) to measure the voltage at the <code>S3</code> or <code>S4</code> test point near the edge of the PolyDAQ board. With the strain gauge at its zero-strain or equilibrium position, turn the potentiometer screw for the appropriate channel so that the voltage at the <code>S3</code> or <code>S4</code> test point becomes about 1.67 volts. This will set the A/D output to about half its full scale so that both positive and negative strains can be measured. If you need the maximum range and resolution possible from the bridge amplifier, you can adjust the potentiometer so that the amplifier output voltage at the <code>S3</code> or <code>S4</code> test point is close to zero, though a zero-strain reading of exactly zero volts is not recommended because it will make a drift of the zero point to voltages below zero undetectable. After you've adjusted the gain potentiometer, apply some positive load to the device being tested (if possible) and verify that the amplifier output voltage is going in the right direction. If it is going the wrong way, reversing the Wheatstone bridge output connections to the <code>Sn+</code> and <code>Sn-</code> terminals and re-zeroing the bridge will cause positive strains to register as positive voltages.</p>
<h3><a class="anchor" id="sg_calib"></a>
Calibration</h3>
<p>The excitation voltage for the strain gauges is nominally 3.3 volts. For the best accuracy, you can measure the excitation voltage when all your strain gauges are connected and the PolyDAQ 2 is using the same power supply (such as a particular laptop's USB connection) that is used during your tests. Make sure to use an accurate voltmeter set to the range which gives the most resolution. Each strain gauge bridge amplifier has a gain of 100.2 &plusmn; 0.5%. The bridge output goes directly to the 12-bit A/D converter's input, and the A/D converter's reference voltage is supplied by a high-accuracy 3.3 volt reference source (LT1460) whose accuracy rating is better than 0.1%.</p>
<h1><a class="anchor" id="sec_vin"></a>
Voltage Inputs</h1>
<h2><a class="anchor" id="ss_vin_steps"></a>
Steps</h2>
<ol type="1">
<li>Ensure that your voltage source produces at least 0.5 volts or so of output when your maximum signal is being measured and that it has a negative output or common ground that can be connected to the PolyDAQ's ground.</li>
<li>Ensure that you can power the sensor from the PolyDAQ's 3.3 volt excitation voltage (<code>VEX</code> terminals). If not, find an appropriate power supply for your sensor. The power supply's ground must be attached to the PolyDAQ's ground. In any case, sensors whose output is greater than &plusmn; 10 volts should not be used.</li>
<li>If the sensor's output will always be in the range of 0 &ndash; 3.3 volts, connect the sensor's output to the board's <code>V_3</code> or <code>V_4</code> input if you have a PolyDAQ 0-4-4 board, or any voltage input for a PolyDAQ 4-4-2 board.</li>
<li>If the sensor's output is larger but in the range of -10 to +10 volts, connect it to the <code>V_1</code> or <code>V_2</code> input of a PolyDAQ 0-4-4 board or any voltage input of a PolyDAQ 4-4-2 board.</li>
<li>Check that the calibration of voltage inputs is correct using a high accuracy voltmeter (not the $4.00 kind).</li>
</ol>
<h2><a class="anchor" id="ss_vin_det"></a>
Details</h2>
<p>The PolyDAQ 2 has two types of voltage inputs, with different configurations of the board using different combinations thereof:</p>
<ul>
<li> &plusmn; 10 volt inputs. These inputs use a voltage divider and level shifter circuit to convert signals in the range of approximately -10 to 10 volts into signals in the range 0 &ndash; 3.3 volts, which are measured by the A/D converter. If the inputs are disconnected, the A/D converter will return a reading of about 2048, or halfway between the minimum and maximum. Connecting these inputs to ground should produce an A/D output of about 1726.</li>
<li>0 &ndash; 3.3 volt inputs. These inputs All the voltage inputs are single-ended; that is, all are referenced to ground. Differential voltage measurements must be made using an external differential amplifier or, for small enough differences, the strain gauge bridge amplifiers as described in the <a class="el" href="pd_sensors.html#sec_mV">Millivolt Inputs</a> section.</li>
</ul>
<p>For best accuracy, voltage inputs should be calibrated against a high-accuracy voltmeter. The resistors used to divide and shift &plusmn; 10 volt signals into the 0 &ndash; 3.3 volt signals read by the analog to digital converter are not especially high accuracy resistors, so the gains of individual PolyDAQ boards may vary by up to about 3%. The 0 &ndash; 3.3V inputs should be accurate to within better than 0.5% as long as input impedance is not a problem.</p>
 &plusmn; 10 volt inputs have an input impedance of approximately 220K &Omega;. This means that they can be used to measure signals from amplified transducers without loading the measured signals, but low-energy signals such as those from piezoelectric, capacitive, thermocouple, and biological sensors must be amplified by proper signal conditioning amplifiers before being sent to the PolyDAQ's voltage inputs.</p>
<p>0 &ndash; 3.3 volt inputs have an input impedance of approximately 300K &Omega; and are subject to the same considerations of source impedance as the &plusmn; 10 volt inputs. Although these inputs are somewhat protected from excessive voltages by series resistors at their inputs, care must be taken to prevent voltages outside the range 0 &ndash; 3.3 volts from being connected to these inputs.</p>
<h3><a class="anchor" id="sec_pot"></a>
Potentiometers</h3>
<p>Using a potentiometer as a position transducer is especially easy.</p>
<ol type="1">
<li>Choose a potentiometer whose resistance is 1K &Omega; to 10K &Omega;, and make sure it has a "linear taper" (linear relationship between angle or distance and resistance change).</li>
<li>Connect one end of the potentiometer to the +3.3V source at a terminal marked <code>VEX</code>.</li>
<li>Connect the other end of the potentiometer to a ground terminal.</li>
<li>Connect the potentiometer's center terminal, the one for the moving "wiper", to a voltage input (on a PolyDAQ 0-4-4, inputs <code>V_3</code> and <code>V_4</code> will give the best resolution).</li>
<li>Run the PolyDAQ GUI or a dumb terminal to test and calibrate the position to voltage transducer. See <a class="el" href="pd_channels.html">Channel Commands</a> for a list of commands to get data from each A/D channel.</li>
</ol>
<h3><a class="anchor" id="sec_mV"></a>
Millivolt Inputs</h3>
<p>If you need to measure a small difference between voltages which are both in the range 0 - 3.3V from ground, you can use a strain gauge bridge amplifier as a differential amplifier with a gain of about 100. It is best to protect the amplifier's inputs by placing 100 &Omega; resistors in series with the voltage source, unless the excitation voltage and ground are used to power the sensors (as they are with strain gauge bridges). If both inputs "float" with respect to ground (such as with self-powering sensors such as thermocouples), use a 100K &Omega; to 1M &Omega; resistor between the <code>Sn-</code> input and ground to ensure that the signals both remain within the measurable range of 0 to 3.3 volts.</p>
<h1><a class="anchor" id="sec_accel"></a>
Accelerometers</h1>
<h2><a class="anchor" id="ss_onb_accel"></a>
The Onboard Accelerometer</h2>
<p>The PolyDAQ 0-4-4 has an accelerometer on the board. This accelerometer, a Freescale MMA8452Q, is a modern micromachined electromechanical system (MEMS) device. It sends data in digital form over an I2C bus. It can measure 3 axes of accelerations with 12-bit resolution and a full-scale reading of  &plusmn; 2 g, &plusmn; 4 g, or &plusmn; 8 g; the accelerometer is normally set to read &plusmn; 2 g. There are white printed arrows on the board showing the directions of the X, Y, and Z axes as measured. There are no connections needed to use the onboard accelerometer. Set the Python GUI to read the accelerometer, or use channel commands <code>X</code>, <code>Y</code>, and/or <code>Z</code> (note that these are <em>uppercase</em> letters) in the data logger configuration file (see section <a class="el" href="pd_setup.html#pds_sd_config">The Configuration File</a>). Accelerometer data can be taken at up to 200 samples per second.</p>
<h2><a class="anchor" id="ss_ext_accel"></a>
An External Accelerometer</h2>
<p>An external accelerometer, also a MMA8452Q, can be connected to the I2C connector which is located next to the black power jack near one corner of the board. The external accelerometer will be mounted to a "breakout board", a small circuit board with connections that are labeled <code>3.3V</code>, <code>SCL</code>, <code>SDA</code>, and <code>GND</code>. The four pins of the I2C connector are labeled <code>3V3</code>, <code>SCL</code>, <code>SDA</code>, and <code>GND</code>, going from farthest to closest to the power jack. (Connections <code>I1</code> and <code>I2</code> on the breakout board need not be connected.) Turn the PolyDAQ's power off; connect the matching connections on the breakout board to those on the PolyDAQ's connector; turn power back on, and the external accelerometer will be ready to use. The external accelerometer responds to lowercase versions of the internal accelerometer's commands, returning data when queried with <code>x</code>, <code>y</code>, and <code>z</code>.</p>
<div class="image">
<img src="ext_accel_connections_small.png" alt="ext_accel_connections_small.png"/>
</div>
 <h2><a class="anchor" id="ss_ana_accel"></a>
Analog Accelerometers</h2>
<p>Other types of external accelerometers which use analog signals rather than digital ones can be connected directly to the voltage inputs of the PolyDAQ. No special considerations need necessarily be applied when using such accelerometers, except that the accelerometers should be compatible with the 3.3 volt power supplied by the PolyDAQ 2 board, and that power can be connected to the accelerometers by using the <code>VEX</code> connections for the strain gauges and the <code>GND</code> connections next to the voltage inputs.</p>
<h1><a class="anchor" id="sec_thorno"></a>
Thermocouple Inputs</h1>
<p>Who uses <em>those</em> things? </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 11 2015 12:43:10 for PolyDAQ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
